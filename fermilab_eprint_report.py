import re
from invenio.search_engine import perform_request_search
from invenio.search_engine import get_fieldvalues
from invenio.bibformat_engine import BibFormatObject
import invenio.bibformat_elements.bfe_INSPIRE_arxiv as bfe_arxiv

VERBOSE = True
VERBOSE = False

reports = [
'FERMILAB-CONF-09-815-AD',
'FERMILAB-CONF-09-816-AD',
'FERMILAB-CONF-09-827-AD',
'FERMILAB-CONF-09-828-AD',
'FERMILAB-CONF-09-829-AD',
'FERMILAB-CONF-09-830-AD',
'FERMILAB-CONF-09-832-PPD',
'FERMILAB-CONF-09-833-E',
'FERMILAB-CONF-09-834-E',
'FERMILAB-CONF-09-835-E',
'FERMILAB-CONF-09-836-E',
'FERMILAB-CONF-09-837-E',
'FERMILAB-CONF-10-693-E',
'FERMILAB-CONF-10-694-E',
'FERMILAB-CONF-10-695-E',
'FERMILAB-CONF-10-696-E',
'FERMILAB-CONF-10-697-E',
'FERMILAB-CONF-10-698-E',
'FERMILAB-CONF-10-699-E',
'FERMILAB-CONF-08-704-E',
'FERMILAB-CONF-08-705-E',
'FERMILAB-CONF-08-706-E',
'FERMILAB-CONF-08-707-E',
'FERMILAB-CONF-00-399-CD',
'FERMILAB-CONF-99-411-CD',
'FERMILAB-CONF-99-412-CD',
'FERMILAB-PUB-99-413-CD',
'FERMILAB-CONF-11-426-AD',
'FERMILAB-CONF-11-455-AD',
'FERMILAB-FN-0931-AE',
'FERMILAB-PUB-11-485-PPD',
'FERMILAB-CONF-11-495-PPD',
'FERMILAB-CONF-10-701-APC',
'FERMILAB-FN-0935-APC',
'FERMILAB-CONF-11-519-CD',
'FERMILAB-PUB-11-531-CD-E',
'FERMILAB-PUB-11-554-PPD',
'FERMILAB-FN-0936-PPD',
'FERMILAB-PUB-11-600-T',
'FERMILAB-PUB-11-604-T',
'FERMILAB-PUB-11-672-E-PPD',
'FERMILAB-PUB-11-673-PPD',
'FERMILAB-PUB-12-006-A',
'FERMILAB-TM-2525',
'FERMILAB-PUB-12-042-PPD',
'FERMILAB-TM-2528-APC-CD',
'FERMILAB-CONF-12-063-E',
'FERMILAB-FN-0944',
'FERMILAB-TM-2531',
'FERMILAB-CONF-12-089-AD',
'FERMILAB-PUB-12-090-AE',
'FERMILAB-TM-2535-E',
'FERMILAB-CONF-12-220-AD',
'FERMILAB-CONF-12-277-E',
'FERMILAB-CONF-12-300-CD-CMS',
'FERMILAB-CONF-12-303-CD',
'FERMILAB-PUB-11-780-PPD',
'FERMILAB-PUB-12-329-E',
'FERMILAB-PUB-12-334-PPD',
'FERMILAB-PUB-12-374-PPD',
'FERMILAB-CONF-12-379-APC',
'FERMILAB-CONF-12-386-PPD',
'FERMILAB-PUB-12-402-PPD',
'FERMILAB-PUB-12-407-E',
'FERMILAB-CONF-12-414-APC',
'FERMILAB-FN-0949-AD',
'FERMILAB-CONF-12-524-CD',
'FERMILAB-PUB-12-536-A',
'FERMILAB-PUB-12-540-PPD',
'FERMILAB-TEST-12-003-BSS',
'FERMILAB-CONF-12-545-AD-TD',
'FERMILAB-PUB-09-845-CMS',
'FERMILAB-PUB-09-846-CMS',
'FERMILAB-PUB-10-727-CMS',
'FERMILAB-PUB-12-562-AD-APC',
'FERMILAB-PUB-11-816-CMS',
'FERMILAB-PUB-12-651-PPD',
'FERMILAB-CONF-04-559-APC',
'FERMILAB-CONF-03-528-AD',
'FERMILAB-FN-0953-APC',
'FERMILAB-CONF-03-529-AD',
'FERMILAB-TEST-13-001-A',
'FERMILAB-CONF-01-533-APC',
'FERMILAB-CONF-99-000-AD',
'FERMILAB-TM-2552-TD',
'FERMILAB-CONF-13-056-AD',
'FERMILAB-CONF-13-058-AD',
'FERMILAB-CONF-13-060-AD-APC',
'FERMILAB-PUB-13-070-E-PPD',
'FERMILAB-CONF-13-074-CD',
'FERMILAB-CONF-13-078-PPD',
'FERMILAB-PUB-06-591-PPD',
'FERMILAB-PUB-12-668-PPD',
'FERMILAB-CONF-13-110-AD',
'FERMILAB-CONF-13-112-AD',
'FERMILAB-CONF-12-723-E',
'FERMILAB-FN-0959-APC',
'FERMILAB-CONF-13-211-PPD',
'FERMILAB-TM-2559-APC-PPD',
'FERMILAB-CONF-13-245-AD-APC-PPD-T-TD',
'FERMILAB-PUB-13-283-T',
'FERMILAB-TM-2562-APC',
'FERMILAB-CONF-13-292-AD',
'FERMILAB-CONF-13-293-AD',
'FERMILAB-CONF-13-294-AD',
'FERMILAB-CONF-13-312-AD',
'FERMILAB-PUB-13-316-PPD',
'FERMILAB-CONF-10-731-PPD',
'FERMILAB-CONF-11-882-CD',
'FERMILAB-CONF-13-359-TD',
'FERMILAB-CONF-13-369-TD',
'FERMILAB-CONF-13-378-AD',
'FERMILAB-PUB-13-384-CMS',
'FERMILAB-PUB-13-385-E',
'FERMILAB-CONF-13-000-DI',
'FERMILAB-TM-2568',
'FERMILAB-CONF-13-482-CD',
'FERMILAB-PUB-13-491-CD',
'FERMILAB-CONF-13-496-CD',
'FERMILAB-CONF-13-558-T',
'FERMILAB-TEST-13-003-BSS',
'FERMILAB-PUB-13-576-E-PPD',
'FERMILAB-PUB-14-013-A',
'FERMILAB-TM-2578-CD',
'FERMILAB-CONF-14-019',
'FERMILAB-PUB-14-026-PPD',
'FERMILAB-CONF-12-911-E',
'FERMILAB-PUB-14-049-AD-TD',
'FERMILAB-TM-2583-PPD',
'FERMILAB-PUB-14-085-CMS',
'FERMILAB-PUB-12-913-CMS',
'FERMILAB-PUB-12-918-CMS',
'FERMILAB-PUB-08-716-CMS',
'FERMILAB-PUB-07-807-CMS',
'FERMILAB-PUB-07-808-CMS',
'FERMILAB-PUB-07-809-CMS',
'FERMILAB-PUB-06-592-CMS',
'FERMILAB-CONF-14-097-E',
'FERMILAB-PUB-14-112-PPD',
'FERMILAB-CONF-13-648',
'FERMILAB-TEST-14-001-AE-DI',
'FERMILAB-TEST-14-002-BSS',
'FERMILAB-CONF-14-149-AD',
'FERMILAB-PUB-14-153-CMS',
'FERMILAB-PUB-14-156-TD',
'FERMILAB-PUB-14-158-TD',
'FERMILAB-PUB-14-159-TD',
'FERMILAB-TM-2585',
'FERMILAB-CONF-14-221-APC',
'FERMILAB-PUB-14-245-TD',
'FERMILAB-TEST-14-003-ESH',
'FERMILAB-PUB-08-717-E',
'FERMILAB-PUB-14-300-T',
'FERMILAB-CONF-03-538-TD',
'FERMILAB-PUB-13-670',
'FERMILAB-PUB-13-672-TD',
'FERMILAB-PUB-00-408-T',
'FERMILAB-PUB-13-681-A',
'FERMILAB-PUB-06-613-T',
'FERMILAB-TEST-14-006-ND',
'FERMILAB-CONF-14-453-PPD',
'FERMILAB-PUB-14-468-A',
'FERMILAB-TM-2592-AD-APC',
'FERMILAB-FN-0994-PPD',
'FERMILAB-TM-2594',
'FERMILAB-TEST-15-006-FESS',
'FERMILAB-CONF-15-017-CD-ND',
'FERMILAB-FN-0997-ND-T',
'FERMILAB-CONF-15-046-E',
'FERMILAB-PUB-15-056-A',
'FERMILAB-PUB-15-079-E',
'FERMILAB-PUB-15-083-APC',
'FERMILAB-PUB-15-119-CMS',
'FERMILAB-CONF-15-146-AD',
'FERMILAB-CONF-15-147-AD',
'FERMILAB-PUB-14-571-PPD',
'FERMILAB-CONF-15-154-CD',
'FERMILAB-CONF-15-155-CD',
'FERMILAB-CONF-15-157-CD',
'FERMILAB-CONF-15-158-CD',
'FERMILAB-TM-2600-CD',
'FERMILAB-TM-2601-CD',
'FERMILAB-TM-2602-CD',
'FERMILAB-CONF-15-167-APC',
'FERMILAB-CONF-15-168-APC',
'FERMILAB-CONF-15-172-ND',
'FERMILAB-CONF-15-193-CD',
'FERMILAB-CONF-15-204-ND',
'FERMILAB-TM-2604-CD',
'FERMILAB-CONF-15-217-ND',
'FERMILAB-CONF-15-219-CD',
'FERMILAB-CONF-15-221-ND',
'FERMILAB-CONF-15-242-ND',
'FERMILAB-CONF-15-266-TD',
'FERMILAB-CONF-15-270-AD',
'FERMILAB-CONF-15-316-TD',
'FERMILAB-PUB-15-317-AD',
'FERMILAB-CONF-15-344-AD',
'FERMILAB-CONF-15-360-PPD',
'FERMILAB-PUB-15-367-APC',
'FERMILAB-CONF-15-369-AD',
'FERMILAB-CONF-15-412-AD-TD',
'FERMILAB-PUB-15-421-CMS',
'FERMILAB-PUB-15-441-AE',
'FERMILAB-TEST-15-007-CD',
'FERMILAB-PUB-15-458-ND',
'FERMILAB-CONF-15-481-CD-T',
'FERMILAB-PUB-15-515-CMS',
'FERMILAB-CONF-14-580-ND',
'FERMILAB-CONF-15-564-ND',
'FERMILAB-PUB-08-729-CMS',
'FERMILAB-PUB-16-004-T',
'FERMILAB-CONF-16-015-ND',
'FERMILAB-CONF-15-620-ND',
'FERMILAB-PUB-16-021-AE',
'FERMILAB-FN-1007-CD',
'FERMILAB-CONF-16-078-PPD',
'FERMILAB-PUB-16-112-ND',
'FERMILAB-TEST-16-001-LDRD',
'FERMILAB-PUB-16-145-ND',
'FERMILAB-TM-2626-CMS-E',
'FERMILAB-CONF-16-163-AD',
'FERMILAB-CONF-16-167-FESS',
'FERMILAB-PUB-16-170-CD',
'FERMILAB-PUB-16-172-ND',
'FERMILAB-PUB-16-191-CMS',
'FERMILAB-PUB-16-193-CMS',
'FERMILAB-FN-1018-TD',
'FERMILAB-PUB-16-220',
'FERMILAB-TM-2628-ND',
'FERMILAB-CONF-16-236-AD',
'FERMILAB-PUB-16-248-TD',
'FERMILAB-PUB-16-249-TD',
'FERMILAB-PUB-16-256-CMS',
'FERMILAB-PUB-16-262-T',
'FERMILAB-TM-2629-APC',
'FERMILAB-CONF-16-295-E',
'FERMILAB-CONF-16-298-E',
'FERMILAB-PUB-16-301-T',
'FERMILAB-PUB-16-304-PPD',
'FERMILAB-PUB-16-313-CMS',
'FERMILAB-PUB-16-314-T',
'FERMILAB-PUB-16-315-A-AE-PPD-T',
'FERMILAB-TM-2632-ND-PPD',
'FERMILAB-PUB-16-318-A'
]

BAD_RECIDS = [1340468, 1278565]

def get_eprint(r):
    report_fermilab = ''
    eprint = ''
    reports = get_fieldvalues(r,'037__a')
    reports = reports + get_fieldvalues(r,'037__z')
    if VERBOSE:
        print reports
    for report in reports:
        if re.search("FERMILAB", report):
            report_fermilab = report
            if VERBOSE:
                print report_fermilab
    bfo = BibFormatObject(r)
    eprint = bfe_arxiv.get_arxiv(bfo, category = "no")
    if VERBOSE:
        print eprint
    if eprint: 
        eprint = eprint[0]
        if report_fermilab:
            print report_fermilab, eprint


for report in reports:
    search = "037:" + report
    result = perform_request_search(p=search,cc='HEP')    
    if len(result) == 1:
        recid = result[0]
        if recid in BAD_RECIDS:
            continue
        else:
            get_eprint(recid)
    elif len(result) == 0:
        pass
    else:
        print "Something funny here " + report + len(result)


